@model List<FirstWebApp.Models.productsTable>

@{
    ViewData["Title"] = "My Work";
    var userId = ViewData["userId"];
    var products = ViewData["Products"] as List<FirstWebApp.Models.productsTable>;
}

<div class="row" id="work" style="margin-top:128px">
	<h1 class="w3-center">OUR WORK</h1>
	<p class="w3-center w3-large">Services and Products we offer</p>

	<div class="w3-row-padding" style="margin-top:64px">
		@foreach (var product in products)
		{
			if (product.IsActive == 1 || (int)userId == 12)
			{
				<div class="w3-col l3 m6 w3-margin-bottom">
					<div class="w3-card">
						<img src="@product.ImageURL" alt="Product picture" style="width:100%">
						<div class="w3-container w3-center">
							<h4 class="card-title">@product.Name</h4>
							<p class="card-text">R@{
									var price = decimal.Parse(product.Price); @price.ToString("F2")
								}</p>
							<p class="card-text">@product.Category</p>
							@if ((int)userId == 12)
							{
								<p class="card-text">Product ID: @product.ProductID</p>
								
							}else if(@product.Availability == "True")
							{
								<p class="card-text">Available</p>
								<p>
									<form asp-controller="Transaction" asp-action="PlaceOrder" method="post">
										<input type="hidden" name="userID" value="@userId" />
										<input type="hidden" name="productID" value="@product.ProductID" />
										<button type="submit" class="btn btn-primary">Place Order</button>
									</form>
								</p>
							}
							else
							{
								<p class="card-text">Unavailable</p>
							}@if (userId.Equals(12))
							{
								if (product.IsActive == 0)
								{
									<p>
										<form asp-controller="Product" asp-action="AddProduct" method="post">
											<input type="hidden" name="productID" value="@product.ProductID" />
											<button type="submit" class="btn btn-danger">Add product</button>
										</form>
									</p>
									
								}
								else
								{
									<p>
										<form asp-controller="Product" asp-action="RemoveProduct" method="post">
											<input type="hidden" name="productID" value="@product.ProductID" />
											<button type="submit" class="btn btn-danger">Remove Product</button>
										</form>
									</p>
								}

								<p>
									<form asp-controller="Product" asp-action="UpdateAvailability" method="post">
										<input type="hidden" name="productID" value="@product.ProductID" />
										<input type="radio" name="availability" value="True"> Available
										<input type="radio" name="availability" value="False"> Unavailable
										<p><button type="submit" class="btn btn-primary">Update Availability</button></p>
									</form>
								</p>

								<p>
									<form asp-controller="Product" asp-action="UpdatePrice" method="post">
										<input type="hidden" name="productID" value="@product.ProductID" />
										<p><input class="w3-input w3-border" type="number" placeholder="Price" required name="Price" id="priceInput"></p>
										<p><button type="submit" class="btn btn-primary">Update Price</button></p>
									</form>
								</p>
							 }
						</div>
					</div>
				</div>
			}
		}
	</div>
</div>

@if ((int)userId == 12)
{
	<div class="w3-container" style="padding:128px 16px" id="addProd">
		<h3 class="w3-center">Add Products or services</h3>
		<div style="margin-top:48px">
			<br>
			<form id="uploadForm" action="MyWork" method="post" enctype="multipart/form-data">
				<p><input class="w3-input w3-border" type="text" placeholder="Name" required name="Name"></p>
				<p><input class="w3-input w3-border" type="number" placeholder="Price" required name="Price" id="priceInput"></p>
				<p><input class="w3-input w3-border" type="text" placeholder="Category" required name="Category"></p>
				<p><input type="radio" name="availability" value="True"> Available
					<input type="radio" name="availability" value="False"> Unavailable</p>
				<p><input type="file" name="Image" accept="image/*" required></p>
				<p>
					<button class="w3-button w3-black" type="submit">
						<i class="fa fa-paper-plane"></i> SEND
					</button>
				</p>
			</form>
			<div id="uploadResult"></div>
		</div>
	</div>
}

@section Scripts {
	<script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
	<script>
        $(function () {
            $('#uploadForm').on('submit', function (e) {
                e.preventDefault();
                var formData = new FormData(this);
                $.ajax({
                    url: $(this).attr('action'),
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        if (data.success) {
                            $('#uploadResult').html('<p>Product uploaded successfully. Reload the page to see the new product</p>');
                        } else {
                            $('#uploadResult').html('<p>Error: ' + data.error + '</p>');
                        }
                    },
                    error: function () {
                        $('#uploadResult').html('<p>An error occurred while uploading the product.</p>');
                    }
                });
            });
        });

        // Modal Image Gallery
        function onClick(element) {
            document.getElementById("img01").src = element.src;
            document.getElementById("modal01").style.display = "block";
            var captionText = document.getElementById("caption");
            captionText.innerHTML = element.alt;
        }
    </script>
	<script>
		// Get the price input element
		var priceInput = document.getElementById('priceInput');

		// Add an event listener for input validation
		priceInput.addEventListener('input', function () {
			// Check if the input is a valid number and not less than 0
			if (isNaN(parseFloat(priceInput.value)) || !isFinite(priceInput.value) || parseFloat(priceInput.value) < 0) {
				alert('Please enter a valid positive number for the price.');
				priceInput.value = '';
			}
		});
	</script>
}

